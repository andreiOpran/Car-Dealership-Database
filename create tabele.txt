CREATE TABLE MOTOR
(
    ID_MOTOR INT PRIMARY KEY,
    MARCA VARCHAR(30) DEFAULT 'NECUNOSCUT',
    MODEL VARCHAR(30) DEFAULT 'NECUNOSCUT'
);

CREATE TABLE CARBURANT
(
    ID_CARBURANT INT PRIMARY KEY,
    TIP VARCHAR(30) DEFAULT 'Necunoscut',
    VARIANTA VARCHAR(30) DEFAULT 'Necunoscut',
    PRET_LITRU NUMBER(3,2),
    CONSTRAINT CHECK_PRET_LITRU CHECK (PRET_LITRU > 0),
    CONSTRAINT CHECK_TIP CHECK (TIP IN ('Benzina', 'Motorina'))
);

CREATE TABLE MOTOR_CARBURANT
(
    ID_MOTOR INT PRIMARY KEY,
    ID_CARBURANT INT,
    CAI_PUTERE INT,
    CAPACITATE_CILINDRICA_LITRI NUMBER(3,1),
    CONSUM_MEDIU_LITRI NUMBER(4,2),
    ASPIRATIE VARCHAR(30) DEFAULT 'Aspirat',
    FOREIGN KEY (ID_MOTOR) REFERENCES MOTOR(ID_MOTOR),
    FOREIGN KEY (ID_CARBURANT) REFERENCES CARBURANT(ID_CARBURANT),
    CONSTRAINT CHECK_CAI_PUTERE_CARBURANT CHECK (CAI_PUTERE > 0),
    CONSTRAINT CHECK_CAPACITATE_CILINDRICA_LITRI CHECK (CAPACITATE_CILINDRICA_LITRI > 0),
    CONSTRAINT CHECK_CONSUM_MEDIU_LITRI CHECK (CONSUM_MEDIU_LITRI > 0),
    CONSTRAINT CHECK_ASPIRATIE CHECK (ASPIRATIE IN ('Aspirat', 'Turbina'))
);

CREATE TABLE MOTOR_ELECTRIC
(
    ID_MOTOR INT PRIMARY KEY,
    CAI_PUTERE INT,
    TIMP_INCARCARE_ORE NUMBER(4,3),
    AUTONOMIE_KM INT,
    FOREIGN KEY (ID_MOTOR) REFERENCES MOTOR(ID_MOTOR),
    CONSTRAINT CHECK_CAI_PUTERE_ELECTRIC CHECK (CAI_PUTERE > 0),
    CONSTRAINT CHECK_TIMP_INCARCARE_ORE CHECK (TIMP_INCARCARE_ORE > 0),
    CONSTRAINT CHECK_AUTONOMIE_KM CHECK (AUTONOMIE_KM > 0)
);

CREATE TABLE CAROSERIE
(
    ID_CAROSERIE INT PRIMARY KEY,
    NUME VARCHAR(30) DEFAULT 'Necunoscut',
    NR_USI INT DEFAULT 4,
    NR_LOCURI INT DEFAULT 5,
    VOLUM_PORTBAGAJ_LITRI INT DEFAULT 500,
    CONSTRAINT CHECK_NR_USI CHECK (NR_USI > 0),
    CONSTRAINT CHECK_NR_LOCURI CHECK (NR_LOCURI > 0),
    CONSTRAINT CHECK_VOLUM_PORTBAGAJ_LITRI CHECK (VOLUM_PORTBAGAJ_LITRI > 0)
);

CREATE TABLE ADRESA
(
    ID_ADRESA INT PRIMARY KEY,
    STRADA VARCHAR(30) DEFAULT 'Necunoscut',
    NR INT,
    ORAS VARCHAR(30) DEFAULT 'Necunoscut',
    CONSTRAINT CHECK_NR_ADRESA CHECK (NR > 0)
);

CREATE TABLE SHOWROOM
(
    ID_SHOWROOM INT PRIMARY KEY,
    NUME VARCHAR(30) DEFAULT 'Necunoscut',
    ID_ADRESA INT,
    FOREIGN KEY (ID_ADRESA) REFERENCES ADRESA(ID_ADRESA)
);

CREATE TABLE SHOWROOM_NUMERE_TELEFON
(
    ID_NUMAR INT PRIMARY KEY,
    ID_SHOWROOM_NUMAR_TELEFON INT,
    NR_TELEFON VARCHAR(30),
    CONSTRAINT CHECK_NR_TELEFON_SHOWROOM CHECK
        (
            REGEXP_LIKE(NR_TELEFON, '^07[0-9]{2} [0-9]{3} [0-9]{3}$')
        ),
    FOREIGN KEY (ID_SHOWROOM_NUMAR_TELEFON) REFERENCES SHOWROOM(ID_SHOWROOM)
);

CREATE TABLE VEHICUL
(
    ID_VEHICUL INT PRIMARY KEY,
    ID_SHOWROOM INT,
    ID_CAROSERIE INT,
    ID_MOTOR INT,
    MARCA VARCHAR(30) DEFAULT 'Necunoscut',
    MODEL VARCHAR(30) DEFAULT 'Necunoscut',
    AN_FABRICATIE INT DEFAULT 2024,
    PRET NUMBER(10,2),
    FOREIGN KEY (ID_SHOWROOM) REFERENCES SHOWROOM(ID_SHOWROOM),
    FOREIGN KEY (ID_CAROSERIE) REFERENCES CAROSERIE(ID_CAROSERIE),
    FOREIGN KEY (ID_MOTOR) REFERENCES MOTOR(ID_MOTOR),
    CONSTRAINT CHECK_AN_FABRICATIE CHECK (AN_FABRICATIE > 0),
    CONSTRAINT CHECK_PRET CHECK (PRET > 0)
);

CREATE TABLE ANGAJAT_SHOWROOM
(
    ID_ANGAJAT INT PRIMARY KEY,
    ID_SHOWROOM INT,
    NUME VARCHAR(30) DEFAULT 'Necunoscut',
    DATA_ANGAJARE DATE DEFAULT SYSDATE,
    SALARIU NUMBER(10,2),
    FOREIGN KEY (ID_SHOWROOM) REFERENCES SHOWROOM(ID_SHOWROOM),
    CONSTRAINT CHECK_SALARIU CHECK (SALARIU > 0)
);

CREATE TABLE MECANIC
(
    ID_ANGAJAT INT PRIMARY KEY,
    ID_SPECIALIZARE INT,
    FOREIGN KEY (ID_ANGAJAT) REFERENCES ANGAJAT_SHOWROOM(ID_ANGAJAT),
    FOREIGN KEY (ID_SPECIALIZARE) REFERENCES MOTOR(ID_MOTOR)
);

CREATE TABLE VANZATOR
(
    ID_ANGAJAT INT PRIMARY KEY,
    ID_SPECIALIZARE INT,
    FOREIGN KEY (ID_ANGAJAT) REFERENCES ANGAJAT_SHOWROOM(ID_ANGAJAT),
    FOREIGN KEY (ID_SPECIALIZARE) REFERENCES CAROSERIE(ID_CAROSERIE)
);

CREATE TABLE CLIENT
(
    ID_CLIENT INT PRIMARY KEY,
    NUME VARCHAR(30)
);

CREATE TABLE CLIENT_NUMERE_TELEFON
(
    ID_NUMAR INT PRIMARY KEY,
    ID_CLIENT_NR_TELEFON INT,
    NR_TELEFON VARCHAR(30),
    CONSTRAINT CHECK_NR_TELEFON_CLIENTI CHECK
    (
        REGEXP_LIKE(NR_TELEFON, '^07[0-9]{2} [0-9]{3} [0-9]{3}$')
    ),
    FOREIGN KEY (ID_CLIENT_NR_TELEFON) REFERENCES CLIENT(ID_CLIENT)
);

CREATE TABLE VEHICUL_DETINUT_CLIENT
(
    ID_VEHICUL INT PRIMARY KEY,
    ID_CLIENT INT,
    ID_CAROSERIE INT,
    ID_MOTOR INT,
    MARCA VARCHAR(30) DEFAULT 'Necunoscut',
    MODEL VARCHAR(30) DEFAULT 'Necunoscut',
    AN_FABRICATIE INT,
    NUMAR_INMATRICULARE VARCHAR(30) UNIQUE,
    FOREIGN KEY (ID_CLIENT) REFERENCES CLIENT(ID_CLIENT),
    FOREIGN KEY (ID_CAROSERIE) REFERENCES CAROSERIE(ID_CAROSERIE),
    FOREIGN KEY (ID_MOTOR) REFERENCES MOTOR(ID_MOTOR),
    CONSTRAINT CHECK_AN_FABRICATIE_VEHICUL_DETINUT_CLIENT CHECK (AN_FABRICATIE > 0),
    CONSTRAINT CHECK_NUMAR_INAMTRICULARE CHECK
    (
        REGEXP_LIKE(NUMAR_INMATRICULARE, '^(AB|AR|AG|B|BC|BH|BN|BR|BZ|CS|CL|CJ|CT|CV|DB|DJ|GL|GR|GJ|HR|HD|IL|IS|IF|MM|MH|MS|NT|OT|PH|SM|SJ|SB|SV|TR|TM|TL|VS|VL|VN|CD|CO|TC) [0-9]{2,3} [A-Z]{3}$')
    )
);

CREATE TABLE PLATA
(
    ID_PLATA INT PRIMARY KEY,
    ID_CLIENT INT,
    SUMA NUMBER(10,2),
    FOREIGN KEY (ID_CLIENT) REFERENCES CLIENT(ID_CLIENT),
    CONSTRAINT CHECK_SUMA CHECK (SUMA > 0)
);

CREATE TABLE TRANZACTIE
(
    ID_TRANZACTIE INT PRIMARY KEY,
    ID_CLIENT INT,
    ID_PLATA INT,
    ID_VEHICUL INT,
    ID_ANGAJAT INT,
    DATA_TRANZACTIE DATE DEFAULT SYSDATE,
    SUMA NUMBER(10,2),
    FOREIGN KEY (ID_CLIENT) REFERENCES CLIENT(ID_CLIENT),
    FOREIGN KEY (ID_PLATA) REFERENCES PLATA(ID_PLATA),
    FOREIGN KEY (ID_VEHICUL) REFERENCES VEHICUL_DETINUT_CLIENT(ID_VEHICUL),
    FOREIGN KEY (ID_ANGAJAT) REFERENCES VANZATOR(ID_ANGAJAT),
    CONSTRAINT CHECK_SUMA_TRANZACTIE CHECK (SUMA > 0)
);

CREATE TABLE SERVICE
(
    ID_ANGAJAT INT,
    ID_VEHICUL INT,
    ID_PLATA INT,
    SUMA NUMBER(10,2),
    FOREIGN KEY (ID_ANGAJAT) REFERENCES MECANIC(ID_ANGAJAT),
    FOREIGN KEY (ID_VEHICUL) REFERENCES VEHICUL_DETINUT_CLIENT(ID_VEHICUL),
    FOREIGN KEY (ID_PLATA) REFERENCES PLATA(ID_PLATA)
);